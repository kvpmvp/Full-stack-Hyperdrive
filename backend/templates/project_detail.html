{% extends "base.html" %}
{% block content %}
<div class="grid md:grid-cols-3 gap-8">
  <div class="md:col-span-2 space-y-4">
    <div class="flex items-start gap-4">
      <img src="/static/logo.svg" class="h-10 w-10" />
      <div>
        <div class="text-2xl font-semibold">{{ p.name }}</div>
        <div class="text-slate-400 text-sm">by {{ p.creator }} — <span class="uppercase tracking-widest">{{ p.category }}</span></div>
        <div class="text-sm mt-2">
          Goal: <b>{{ '%.2f' % (p.goal_microalgos / 1_000_000) }}</b> ALGO · Token: ASA #{{ p.token_asset_id }} @ {{ '%.2f' % p.token_rate_per_algo }}/ALGO
        </div>
        <div class="text-sm">Deadline: {{ p.deadline_at.date() }}</div>
        {% if p.app_id %}
        <div class="text-xs text-slate-400 mt-1">App ID: {{ p.app_id }} · Escrow: {{ p.escrow_address }}</div>
        {% else %}
        <div class="text-xs text-amber-400 mt-1">This listing is not on-chain yet.</div>
        {% endif %}
      </div>
    </div>

    <div class="grid md:grid-cols-2 gap-4">
      <div class="p-4 rounded-xl border border-slate-800">
        <div class="font-medium mb-1">Problem</div>
        <div class="text-sm text-slate-300 whitespace-pre-wrap">{{ p.problem }}</div>
      </div>
      <div class="p-4 rounded-xl border border-slate-800">
        <div class="font-medium mb-1">Solution</div>
        <div class="text-sm text-slate-300 whitespace-pre-wrap">{{ p.solution }}</div>
      </div>
      <div class="p-4 rounded-xl border border-slate-800 md:col-span-2">
        <div class="font-medium mb-1">Description</div>
        <div class="text-sm text-slate-300 whitespace-pre-wrap">{{ p.description }}</div>
      </div>
      <div class="p-4 rounded-xl border border-slate-800">
        <div class="font-medium mb-1">Business Model</div>
        <div class="text-sm text-slate-300 whitespace-pre-wrap">{{ p.business_model }}</div>
      </div>
      <div class="p-4 rounded-xl border border-slate-800">
        <div class="font-medium mb-1">Investment Ask</div>
        <div class="text-sm text-slate-300 whitespace-pre-wrap">{{ p.investment_ask }}</div>
      </div>
      <div class="p-4 rounded-xl border border-slate-800 md:col-span-2">
        <div class="font-medium mb-1">Links</div>
        <a class="text-indigo-400 underline" target="_blank" href="{{ p.project_link }}">{{ p.project_link }}</a>
      </div>
    </div>
  </div>

  <div class="space-y-4">
    <div class="p-4 rounded-xl border border-slate-800">
      <div class="font-medium mb-2">Contribute</div>
      {% if p.app_id %}
      <div class="space-y-2">
        <label class="text-sm">From Wallet</label>
        <button id="btn-connect" class="w-full px-3 py-2 rounded-xl bg-slate-800 hover:bg-slate-700 text-sm">Connect Wallet</button>
        <div id="connected-address" class="text-xs text-slate-400"></div>
        <label class="text-sm">Amount (ALGO)</label>
        <input id="contrib-amt" type="number" step="0.01" class="w-full mt-1 rounded-xl bg-slate-900 border border-slate-700 p-2" />
        <button id="btn-contribute" class="w-full mt-2 px-3 py-2 rounded-xl bg-indigo-600 hover:bg-indigo-500 text-sm">Contribute</button>
      </div>
      {% else %}
      <div class="text-sm text-amber-400">On-chain actions unavailable until deployed.</div>
      {% endif %}
    </div>

    <div class="p-4 rounded-xl border border-slate-800">
      <div class="font-medium mb-2">Claims</div>
      {% if p.app_id %}
      <button id="btn-claim-tokens" class="w-full px-3 py-2 rounded-xl bg-slate-800 hover:bg-slate-700 text-sm">Claim Tokens</button>
      <button id="btn-refund" class="w-full mt-2 px-3 py-2 rounded-xl bg-slate-800 hover:bg-slate-700 text-sm">Claim Refund</button>
      {% else %}
      <div class="text-sm text-amber-400">On-chain actions unavailable until deployed.</div>
      {% endif %}
    </div>

    <div class="p-4 rounded-xl border border-slate-800">
      <div class="font-medium mb-2">Admin / Creator</div>
      <p class="text-xs text-slate-400">Use your tooling (deploy script) to opt-in ASA, fund token pool, withdraw or finalize.</p>
    </div>
  </div>
</div>

<script>
const projectId = {{ p.id }};
</script>
{% endblock %}
